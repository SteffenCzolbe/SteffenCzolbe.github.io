<!DOCTYPE html>
<html>

  <head>
    
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>

  Steffen Czolbe


  | Is segmentation uncertainty useful?

</title>
<meta name="description" content="Steffen Czolbe's Website
">

<!-- Open Graph -->

<meta property="og:site_name" content="Steffen Czolbe's Website
" />
<meta property="og:type" content="object" />
<meta property="og:title" content="" />
<meta property="og:url" content="https://steffenczolbe.github.io/projects/2021-06-ipmi2021_prob_segmentation/" />
<meta property="og:description" content="Is segmentation uncertainty useful?" />
<meta property="og:image" content="assets/img/prof_pic.jpg" />


<!-- Bootstrap & MDB -->
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" integrity="sha512-MoRNloxbStBcD8z3M/2BmnT+rg4IsMxPkXaGh2zD6LGNNFE80W3onsAhRcMAMrSoyWL9xD7Ert0men7vR8LUZg==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/css/mdb.min.css" integrity="sha512-RO38pBRxYH3SoOprtPTD86JFOclM51/XTIdEPh5j8sj4tp8jmQIx26twG52UaLi//hQldfrh7e51WzP9wuP32Q==" crossorigin="anonymous" />

<!-- Fonts & Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css"  integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.0/css/academicons.min.css" integrity="sha512-W4yqoT1+8NLkinBLBZko+dFB2ZbHsYLDdr50VElllRcNt2Q4/GSs6u71UHKxB7S6JEMCp5Ve4xjh3eGQl/HRvg==" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

<!-- Code Syntax Highlighting -->
<link rel="stylesheet" href="https://gitcdn.link/repo/jwarby/jekyll-pygments-themes/master/github.css" />

<!-- Styles -->

<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>⇄</text></svg>">

<link rel="stylesheet" href="/assets/css/main.css">
<link rel="canonical" href="/projects/2021-06-ipmi2021_prob_segmentation/">


<!-- Dark Mode -->
<script src="/assets/js/theme.js"></script>
<script src="/assets/js/dark_mode.js"></script>



  </head>

  <body class="fixed-top-nav ">

    <!-- Header -->

    <header>

    <!-- Nav Bar -->
    <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
    <div class="container">
      
      <a class="navbar-brand title font-weight-lighter" href="https://steffenczolbe.github.io/">
       Steffen Czolbe
      </a>
      
      <!-- Navbar Toggle -->
      <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar top-bar"></span>
        <span class="icon-bar middle-bar"></span>
        <span class="icon-bar bottom-bar"></span>
      </button>
      <div class="collapse navbar-collapse text-right" id="navbarNav">
        <ul class="navbar-nav ml-auto flex-nowrap">
          <!-- About -->
          <li class="nav-item ">
            <a class="nav-link" href="/">
              About
              
            </a>
          </li>
          
          <!-- Other pages -->
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li class="nav-item ">
              
                <a class="nav-link" href="https://www.linkedin.com/in/steffen-czolbe/" target="_blank" rel="noopener noreferrer">
                  CV
                  
                </a>
              
          </li>
          
          
          
          
          
          
          
          <li class="nav-item ">
              
                <a class="nav-link" href="/projects/">
                  Projects
                  
                </a>
              
          </li>
          
          
          
          
          
          <li class="nav-item ">
              
                <a class="nav-link" href="/publications/">
                  Publications
                  
                </a>
              
          </li>
          
          
          
          
          
          <li class="nav-item ">
              
                <a class="nav-link" href="/teaching/">
                  Teaching
                  
                </a>
              
          </li>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
            <div class="toggle-container">
              <a id="light-toggle">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
              </a>
            </div>
          
        </ul>
      </div>
    </div>
  </nav>

</header>


    <!-- Content -->

    <div class="container mt-5">
      <div class="post">

  <header class="post-header">
    <h1 class="post-title">Is segmentation uncertainty useful?</h1>
    <h2 class="post-description">A critical view on multiple common probabilistic models.</h2>
  </header>

  <article>
    <div class="profile float-right">
    


<img class="img-fluid z-depth-1 rounded" src="/assets/resized/uncertainty_thumbnail-480x343.png" srcset="    /assets/resized/uncertainty_thumbnail-480x343.png 480w,/ assets/img/uncertainty_thumbnail.png 550w">

    <div class="caption">
        Probabilistic segmentation models allow us to sample from a distribution of segmentations!
    </div>
</div>

<p>Probabilistic image segmentation models provide a distribution of likely segmentation masks. Various characteristics of the distribution can be used to assess the prediction confidence of the model. Find the paper <a href="https://arxiv.org/abs/2103.16265v1" target="_blank" rel="noopener noreferrer">here</a> and the code on <a href="https://github.com/SteffenCzolbe/probabilistic_segmentation" target="_blank" rel="noopener noreferrer">Github</a>.</p>

<h3 id="models">Models</h3>

<p>We investigate four common models used to predict segmentation uncertainty:</p>

<ul>
  <li>A simple U-Net with a softmax-output layer.</li>
  <li>An ensemble of U-Nets.</li>
  <li>MC-Dropout, a method that approximates Bayesian weight distributions.</li>
  <li>Probabilistic U-Net, a fusion between a VAE and a U-Net.</li>
</ul>

<div class="row">
    <div class="col-sm mt-3 mt-md-0">
        


<img class="img-fluid rounded z-depth-1" src="/assets/resized/uncertainty_models-800x238.png" srcset="    /assets/resized/uncertainty_models-480x143.png 480w,    /assets/resized/uncertainty_models-800x238.png 800w,/ assets/img/uncertainty_models.png 1390w" title="Schematic overview of the evaluated models">

    </div>
</div>
<div class="caption">
    Schematic overview of the evaluated models. Blue: residual blocks. Orange: Dropout layers essential to the networks’ functionality.
</div>

<h3 id="results">Results</h3>

<p>We evaluate the models on two datasets: (1) Skin leision segmentation and (2) Lung cancer segmentation. We see, that all models are relatively certain on correct predictions (TP + TN), and less certain on wrong predictions (FP + FN). Outliers are the MC-dropout model, which seems to be never completely certain in our case (possibly due to bad calibration), and TPs on the lung cancer dataset. The Lung cancer dataset has a large class imbalance, with very little cancer cells. This might explain my models are reluctant to be overly confident on detected cancer cells.</p>

<div class="row">
    <div class="col-sm mt-3 mt-md-0">
        


<img class="img-fluid rounded z-depth-1" src="/assets/resized/uncertainty_results-800x331.png" srcset="    /assets/resized/uncertainty_results-480x198.png 480w,    /assets/resized/uncertainty_results-800x331.png 800w,/ assets/img/uncertainty_results.png 1357w" title="Schematic overview of the evaluated models">

    </div>
</div>
<div class="caption">
    All models are relatively certain on correct predictions (TP + TN), and less certain on wrong predictions (FP + FN).
</div>

<p>Separating model performance by whether different human annotators fully agree, somewhat agree, or completely disagree shows very little difference between models: All models are certain when the humans agree, and uncertain when humans disagree.</p>

<div class="row">
    <div class="col-sm mt-3 mt-md-0">
        


<img class="img-fluid rounded z-depth-1" src="/assets/resized/uncertainty_results2-800x286.png" srcset="    /assets/resized/uncertainty_results2-480x172.png 480w,    /assets/resized/uncertainty_results2-800x286.png 800w,/ assets/img/uncertainty_results2.png 1355w" title="Schematic overview of the evaluated models">

    </div>
</div>
<div class="caption">
    Model agreement with expert annotators, and generalized energy distance of the model output distribution to tthe distribution sampled from four human annotators. The models look very similar here.
</div>

<h3 id="active-learning">Active learning</h3>

<p>Finally, we try to use the uncertainty estimations: In an active learning setting, we try to develop a “smart” strategy on what samples to include into the dataset next. This can inform annotation strategies and lower annotation cost. We trial an uncertainty-sampling strategy against random sampling. In most cases, the model with the random strategy performs better.</p>

<p>Investigating the samples selected by the uncertainty-based strategy reveals that the model frequently chose to include samples where even the group of expert annotators provided disagreeing segmentation masks, providing little information for the model to learn from.</p>

<div class="row">
    <div class="col-sm mt-3 mt-md-0">
        


<img class="img-fluid rounded z-depth-1" src="/assets/resized/uncertainty_active_learning-800x326.png" srcset="    /assets/resized/uncertainty_active_learning-480x196.png 480w,    /assets/resized/uncertainty_active_learning-800x326.png 800w,/ assets/img/uncertainty_active_learning.png 1397w" title="Schematic overview of the evaluated models">

    </div>
</div>
<div class="caption">
    Learning curves for the four algorithms on both datasets, using uncertainty-based sampling and random-based sampling. The random strategy performs better.
</div>

<div class="row">
    <div class="col-sm mt-3 mt-md-0">
        


<img class="img-fluid rounded z-depth-1" src="/assets/resized/uncertainty_active_learning_issue-800x185.png" srcset="    /assets/resized/uncertainty_active_learning_issue-480x111.png 480w,    /assets/resized/uncertainty_active_learning_issue-800x185.png 800w,/ assets/img/uncertainty_active_learning_issue.png 1260w" title="Schematic overview of the evaluated models">

    </div>
</div>
<div class="caption">
    An example of the ambiguous samples frequently selected for inclusion into the training set under the uncertainty-based data gathering strategy. This unseen sample was selected when 150 annotations were revealed. The group of expert annotators provided disagreeing segmentation masks, confirming the model uncertainty but providing little additional information to learn from.
</div>

<h3 id="conclusion">Conclusion</h3>

<p>Is segmentation uncertainty useful? We find that uncertainty,
even in the simplest models, reliably gives practitioners an indication of areas of an image that might be ambiguous, or wrongly segmented. Using uncertainty estimates to reduce the annotation load has proven challenging, with no significant advantage over a random strategy.</p>

  </article>

</div>

    </div>

    <!-- Footer -->

    
<footer class="fixed-bottom">
  <div class="container mt-0">
    © Copyright 2021 <b>Steffen</b>  Czolbe.
    Powered by <a href="http://jekyllrb.com/" target="_blank" rel="noopener noreferrer">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" target="_blank" rel="noopener noreferrer">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="noopener noreferrer">GitHub Pages</a>.

    
    
    Last updated: November 17, 2021.
    
  </div>
</footer>



  </body>

  <!-- jQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>

  <!-- Bootsrap & MDB scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.4.4/umd/popper.min.js" integrity="sha512-eUQ9hGdLjBjY3F41CScH3UX+4JDSI9zXeroz7hJ+RteoCaY+GP/LDoM8AO+Pt+DRFw3nXqsjh9Zsts8hnYv8/A==" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha512-M5KW3ztuIICmVIhjSqXe01oV2bpe248gOxqmlcYrEzAvws7Pw3z6BK0iGbrwvdrUQUhi3eXgtxp5I8PDo9YfjQ==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/js/mdb.min.js" integrity="sha512-Mug9KHKmroQFMLm93zGrjhibM2z2Obg9l6qFG2qKjXEXkMp/VDkI4uju9m4QKPjWSwQ6O2qzZEnJDEeCw0Blcw==" crossorigin="anonymous"></script>

  
<!-- Mansory & imagesLoaded -->
<script defer src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
<script defer src="https://unpkg.com/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
<script defer src="/assets/js/mansory.js" type="text/javascript"></script>


  


<!-- Medium Zoom JS -->
<script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script>
<script src="/assets/js/zoom.js"></script>


<!-- Load Common JS -->
<script src="/assets/js/common.js"></script>

  
<!-- MathJax -->
<script type="text/javascript">
  window.MathJax = {
    tex: {
      tags: 'ams'
    }
  };
</script>
<script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script>
<script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>


  





</html>
